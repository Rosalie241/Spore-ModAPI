<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Messaging | Spore ModAPI SDK for creating C++ mods for Spore</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400i,600,600i%7CSource+Code+Pro:400,400i,600" />
  <link rel="stylesheet" href="m-dark.css" />
  <link rel="stylesheet" href="m-documentation.css" />
  <link rel="icon" href="Spore_ModAPI_Icon.png" type="image/png" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#22272e" />
</head>
<body>
<header><nav id="navigation">
  <div class="m-container">
    <div class="m-row">
      <a href="index.html" id="m-navbar-brand" class="m-col-t-8 m-col-m-none m-left-m"><img src="Spore_ModAPI_Icon.png" alt="" />Spore ModAPI <span class="m-thin">SDK for creating C++ mods for Spore</span></a>
      <div class="m-col-t-4 m-hide-m m-text-right m-nopadr">
        <a href="#search" class="m-doc-search-icon" title="Search" onclick="return showSearch()"><svg style="height: 0.9rem;" viewBox="0 0 16 16">
          <path id="m-doc-search-icon-path" d="m6 0c-3.31 0-6 2.69-6 6 0 3.31 2.69 6 6 6 1.49 0 2.85-0.541 3.89-1.44-0.0164 0.338 0.147 0.759 0.5 1.15l3.22 3.79c0.552 0.614 1.45 0.665 2 0.115 0.55-0.55 0.499-1.45-0.115-2l-3.79-3.22c-0.392-0.353-0.812-0.515-1.15-0.5 0.895-1.05 1.44-2.41 1.44-3.89 0-3.31-2.69-6-6-6zm0 1.56a4.44 4.44 0 0 1 4.44 4.44 4.44 4.44 0 0 1-4.44 4.44 4.44 4.44 0 0 1-4.44-4.44 4.44 4.44 0 0 1 4.44-4.44z"/>
        </svg></a>
        <a id="m-navbar-show" href="#navigation" title="Show navigation"></a>
        <a id="m-navbar-hide" href="#" title="Hide navigation"></a>
      </div>
      <div id="m-navbar-collapse" class="m-col-t-12 m-show-m m-col-m-none m-right-m">
        <div class="m-row">
          <ol class="m-col-t-6 m-col-m-none">
            <li><a href="pages.html">Tutorials</a></li>
            <li><a href="namespaces.html">Namespaces</a></li>
          </ol>
          <ol class="m-col-t-6 m-col-m-none" start="3">
            <li><a href="annotated.html">Classes</a></li>
            <li><a href="files.html">Files</a></li>
            <li class="m-show-m"><a href="#search" class="m-doc-search-icon" title="Search" onclick="return showSearch()"><svg style="height: 0.9rem;" viewBox="0 0 16 16">
              <use href="#m-doc-search-icon-path" />
            </svg></a></li>
          </ol>
        </div>
      </div>
    </div>
  </div>
</nav></header>
<main><article>
  <div class="m-container m-container-inflatable">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <h1>
          Messaging
        </h1>
        <p>The messaging system is used to communicate different parts of the code.</p>
<p>Spore implements a messaging system that is used to communicate between different parts of the code. There are two main concepts: <strong>messages</strong> and <strong>listeners</strong>. A listener is a class that wants to react to a particular message. And messages are events, small pieces of information that are used to notify that something happened.</p><p>Why is this useful? Well, it can be used to correctly componentize code. For example, imagine you change your creature color. The UI developer does not need to know what the game should do when changing the color (play a sound? generate a texture? animate the creature?); instead, it just sends a message, something like &quot;hey,
the play changed the color from this to this&quot;. Then, all the classes that have to react to such change (the editor, the creature baker,...) are listening to that message, and will do whatever they need to do.</p><section id="Messaging-Listeners"><h2><a href="#Messaging-Listeners">Registering a listener</a></h2><p>Listeners are classes that implement <a href="class_app_1_1_i_message_listener.html" class="m-doc">App::<wbr />IMessageListener</a>. You can use the *&quot;ModAPI Message Listener&quot;* item template to create a basic <code>IMessageListener</code> class. As an example, we will directly extend <code>DefaultMessageListener</code>:</p><pre class="m-code"><span class="k">class</span><span class="w"> </span><span class="nc">MyListener</span>
<span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">App</span><span class="o">::</span><span class="n">DefaultMessageListener</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">HandleMessage</span><span class="p">(</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">messageID</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">message</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="p">};</span></pre><aside class="m-note m-info"><h4>Note</h4><p>If your class implements more classes, using <code>DefaultMessageListener</code> might require you to provide extra implementation for <code>AddRef()</code> and <code>Release()</code></p></aside><p>The <code>HandleMessage()</code> method gets called whenever a message we are listening to is generated. <code>messageID</code> is the ID of that message (useful if our class is listening to more than one) and <code>message</code> is extra information, which is optional and depends on the message itself. The return value is not used.</p><pre class="m-code"><span class="kt">bool</span><span class="w"> </span><span class="nf">MyListener::HandleMessage</span><span class="p">(</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">messageID</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">message</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">messageID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">App</span><span class="o">::</span><span class="n">OnModeEnterMessage</span><span class="o">::</span><span class="n">ID</span><span class="p">)</span><span class="w"> </span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// We can do this because we know this message type uses this as message data</span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">App</span><span class="o">::</span><span class="n">OnModeEnterMessage</span><span class="o">*</span><span class="p">)</span><span class="n">message</span><span class="p">;</span>
<span class="w">        </span>
<span class="w">        </span><span class="n">App</span><span class="o">::</span><span class="n">ConsolePrintF</span><span class="p">(</span><span class="s">&quot;Entered mode with id 0x%x&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">-&gt;</span><span class="n">GetModeID</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="p">}</span></pre><p>Now you have to register the listener to that message ID. You can do it inside the <code><a href="effects__example__1_8cpp.html#a98b1050f09da390896f964fb7a892391" class="m-doc">Initialize()</a></code> method of <code>dllmain</code>: <code class="m-code"><span class="n">MessageManager</span><span class="p">.</span><span class="n">AddListener</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">MyListener</span><span class="p">(),</span><span class="w"> </span><span class="n">App</span><span class="o">::</span><span class="n">OnModeEnterMessage</span><span class="o">::</span><span class="n">ID</span><span class="p">);</span></code></p><p>Another example: a listener that prints to the console every time the player changes the creation color in the editor. Download <a href="messaging_example_1.cpp">dllmain.cpp here</a>;</p></section><section id="Messaging-Sending"><h2><a href="#Messaging-Sending">Sending a message</a></h2><p>When a message is sent, all the listeners registered to that ID will be notified. Sending a message is very simple, you just have to use the PostMSG() method:</p><pre class="m-code"><span class="c1">// Send a message with id &quot;MyMessageID&quot; and 4.5 as data;</span>
<span class="kt">float</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">4.5f</span><span class="p">;</span>
<span class="n">MessageManager</span><span class="p">.</span><span class="n">PostMSG</span><span class="p">(</span><span class="n">id</span><span class="p">(</span><span class="s">&quot;MyMessageID&quot;</span><span class="p">),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">r</span><span class="p">);</span></pre></section>
      </div>
    </div>
  </div>
</article></main>
<div class="m-doc-search" id="search">
  <a href="#!" onclick="return hideSearch()"></a>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-m-8 m-push-m-2">
        <div class="m-doc-search-header m-text m-small">
          <div><span class="m-label m-default">Tab</span> / <span class="m-label m-default">T</span> to search, <span class="m-label m-default">Esc</span> to close</div>
          <div id="search-symbolcount">&hellip;</div>
        </div>
        <div class="m-doc-search-content">
          <form>
            <input type="search" name="q" id="search-input" placeholder="Loading &hellip;" disabled="disabled" autofocus="autofocus" autocomplete="off" spellcheck="false" />
          </form>
          <noscript class="m-text m-danger m-text-center">Unlike everything else in the docs, the search functionality <em>requires</em> JavaScript.</noscript>
          <div id="search-help" class="m-text m-dim m-text-center">
            <p class="m-noindent">Search for symbols, directories, files, pages or
            modules. You can omit any prefix from the symbol or file path; adding a
            <code>:</code> or <code>/</code> suffix lists all members of given symbol or
            directory.</p>
            <p class="m-noindent">Use <span class="m-label m-dim">&darr;</span>
            / <span class="m-label m-dim">&uarr;</span> to navigate through the list,
            <span class="m-label m-dim">Enter</span> to go.
            <span class="m-label m-dim">Tab</span> autocompletes common prefix, you can
            copy a link to the result using <span class="m-label m-dim">⌘</span>
            <span class="m-label m-dim">L</span> while <span class="m-label m-dim">⌘</span>
            <span class="m-label m-dim">M</span> produces a Markdown link.</p>
          </div>
          <div id="search-notfound" class="m-text m-warning m-text-center">Sorry, nothing was found.</div>
          <ul id="search-results"></ul>
        </div>
      </div>
    </div>
  </div>
</div>
<script src="search-v2.js"></script>
<script src="searchdata-v2.js" async="async"></script>
<footer><nav>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <p>Spore ModAPI SDK for creating C++ mods for Spore. Created with <a href="https://doxygen.org/">Doxygen</a> 1.9.8 and <a href="https://mcss.mosra.cz/">m.css</a>.</p>
      </div>
    </div>
  </div>
</nav></footer>
</body>
</html>
